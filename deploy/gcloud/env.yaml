# LLM-Memory-Graph Environment Configuration
# Google Cloud Run Environment Variables
#
# This file defines all required environment variables for deployment.
# Secrets are managed via Google Secret Manager and referenced in cloudbuild.yaml
#
# ============================================================================
# ENVIRONMENT-SPECIFIC VALUES
# ============================================================================
# These values change per environment (dev | staging | prod)
# Set via --set-env-vars in gcloud run deploy

environments:
  dev:
    PLATFORM_ENV: "dev"
    SERVICE_NAME: "llm-memory-graph"
    LOG_LEVEL: "debug"
    # Development endpoints (internal)
    RUVECTOR_SERVICE_URL: "https://ruvector-service-dev-xxxxx-uc.a.run.app"
    TELEMETRY_ENDPOINT: "https://llm-observatory-dev-xxxxx-uc.a.run.app"
    # Rate limiting
    RATE_LIMIT_RPS: "100"
    MAX_CONCURRENT_REQUESTS: "50"

  staging:
    PLATFORM_ENV: "staging"
    SERVICE_NAME: "llm-memory-graph"
    LOG_LEVEL: "info"
    # Staging endpoints
    RUVECTOR_SERVICE_URL: "https://ruvector-service-staging-xxxxx-uc.a.run.app"
    TELEMETRY_ENDPOINT: "https://llm-observatory-staging-xxxxx-uc.a.run.app"
    # Rate limiting
    RATE_LIMIT_RPS: "500"
    MAX_CONCURRENT_REQUESTS: "100"

  prod:
    PLATFORM_ENV: "prod"
    SERVICE_NAME: "llm-memory-graph"
    LOG_LEVEL: "warn"
    # Production endpoints (via VPC connector)
    RUVECTOR_SERVICE_URL: "https://ruvector-service-prod-xxxxx-uc.a.run.app"
    TELEMETRY_ENDPOINT: "https://llm-observatory-prod-xxxxx-uc.a.run.app"
    # Rate limiting
    RATE_LIMIT_RPS: "1000"
    MAX_CONCURRENT_REQUESTS: "200"

# ============================================================================
# COMMON CONFIGURATION (All Environments)
# ============================================================================

common:
  # Service identification
  SERVICE_NAME: "llm-memory-graph"

  # Runtime settings
  PORT: "8080"
  NODE_ENV: "production"
  RUST_LOG: "info"

  # gRPC/Metrics (internal)
  GRPC_PORT: "50051"
  METRICS_PORT: "9090"

  # Timeouts
  REQUEST_TIMEOUT_MS: "30000"
  RUVECTOR_TIMEOUT_MS: "10000"

  # Retry configuration
  MAX_RETRIES: "3"
  RETRY_BACKOFF_MS: "1000"

  # Feature flags
  ENABLE_TELEMETRY: "true"
  ENABLE_HEALTH_CHECKS: "true"
  ENABLE_METRICS: "true"

# ============================================================================
# SECRETS (Managed via Google Secret Manager)
# ============================================================================
# These are NOT stored in this file - they are referenced by name only.
# Values are injected at deployment time via --set-secrets

secrets:
  # ruvector-service authentication
  - name: RUVECTOR_API_KEY
    secretManagerName: ruvector-api-key
    description: "API key for ruvector-service persistence layer"
    required: true

  # Service URLs (per environment)
  - name: RUVECTOR_SERVICE_URL
    secretManagerName: ruvector-service-url-${ENV}
    description: "URL for ruvector-service (Postgres-backed persistence)"
    required: true

  - name: TELEMETRY_ENDPOINT
    secretManagerName: observatory-endpoint-${ENV}
    description: "URL for LLM-Observatory telemetry ingestion"
    required: false

# ============================================================================
# REQUIRED ENVIRONMENT VARIABLES CHECKLIST
# ============================================================================
#
# The following environment variables MUST be set for the service to function:
#
# Required:
#   - RUVECTOR_SERVICE_URL  : URL for ruvector-service (Postgres persistence)
#   - RUVECTOR_API_KEY      : Authentication key for ruvector-service
#   - PLATFORM_ENV          : Environment identifier (dev|staging|prod)
#   - SERVICE_NAME          : Service name for logging/telemetry
#   - SERVICE_VERSION       : Deployment version (set by Cloud Build)
#
# Optional (with defaults):
#   - TELEMETRY_ENDPOINT    : LLM-Observatory URL (telemetry disabled if unset)
#   - PORT                  : HTTP port (default: 8080)
#   - LOG_LEVEL             : Logging verbosity (default: info)
#   - REQUEST_TIMEOUT_MS    : Request timeout (default: 30000)
#
# CRITICAL CONSTRAINTS:
#   - NO agent hardcodes service names or URLs
#   - NO agent embeds credentials or secrets
#   - ALL dependencies resolve via environment variables
#   - ALL persistence occurs via ruvector-service ONLY
#   - NO direct Google SQL / Postgres connections
